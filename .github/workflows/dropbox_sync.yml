name: dropbox-sync

on:
  schedule:
    - cron: "0 * * * *"   # æ¯æ™‚0åˆ†ã«å®Ÿè¡Œï¼ˆå¿…è¦ã«å¿œã˜ã¦å¤‰æ›´ï¼‰
  workflow_dispatch:

jobs:
  sync:
    runs-on: ubuntu-latest
    timeout-minutes: 15
    env:
      DROPBOX_APP_KEY: ${{ secrets.DROPBOX_APP_KEY }}
      DROPBOX_APP_SECRET: ${{ secrets.DROPBOX_APP_SECRET }}
      DROPBOX_REFRESH_TOKEN: ${{ secrets.DROPBOX_REFRESH_TOKEN }}
      DROPBOX_FOLDER_PATH: "/Apps/slot-data-analyzer"
    steps:
      - uses: actions/checkout@v4

      - uses: actions/setup-python@v5
        with:
          python-version: "3.11"

      - name: Install dependencies
        run: |
          pip install dropbox==11.36.2

      - name: Sync Dropbox folder
        run: |
          python <<'PY'
          import os, dropbox

          folder_path = os.getenv("DROPBOX_FOLDER_PATH")
          dbx = dropbox.Dropbox(
              oauth2_refresh_token=os.getenv("DROPBOX_REFRESH_TOKEN"),
              app_key=os.getenv("DROPBOX_APP_KEY"),
              app_secret=os.getenv("DROPBOX_APP_SECRET")
          )

          print(f"ğŸ“‚ Dropboxãƒ•ã‚©ãƒ«ãƒ€: {folder_path}")
          res = dbx.files_list_folder(folder_path)
          if not res.entries:
              print("âš  ãƒ•ã‚©ãƒ«ãƒ€ã¯ç©ºã§ã™")
          else:
              for e in res.entries:
                  print(f"- {e.name}")
          PY